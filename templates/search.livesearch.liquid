{% layout none %}{% assign preferred = "0" %}{% if search.terms == "* *" or search.terms contains "LSINIT" %}{% assign numResults = 500 %}{% if search.terms contains "LSINIT" %}{% assign preferred = "1" %}{% endif %}{% else %}{% assign numResults = 50 %}{% endif %}{% paginate search.results by numResults %}{% capture output %}{% if search.results_count > 0 %}{% if search.types contains "product" %}{% assign searchresults = search.results  %}{% else %}{% assign searchresults = search.results %}{% endif %}[{% for result in searchresults limit:numResults %}{% if result.metafields.inventory.ShappifyHidden == "true" or result.tags contains "HiddenProduct" %}{% else %}{% assign resultURL = result.url %}{% if result.object_type == "product"%}{% assign thumbURL = result.images[0] | product_img_url: 'thumb' %}{% elsif result.object_type == "article"%}{% assign thumbURL = result.image | img_url: 'thumb' %}{% else %}{% if result.image.src %}{% assign thumbURL = result.image.src | img_url: 'small' %}{% else %}{% assign thumbURL = 'logo.png' | asset_url %}{% endif %}{% endif %}{% capture resulttitle %} {{result.title}} {% endcapture %}{"title":"{% include 'json_cleanup' with resulttitle %}","price":"{{ result.price | money_with_currency | replace: '"', '\"' }}","price2":"{{ result.price  }}","url":"{% include 'json_cleanup' with resultURL %}","thumb":"{% include 'json_cleanup' with thumbURL %}","id":{{result.id}},"preferred":"{{preferred}}","published_at":"{{ result.published_at }}","created_at":"{{ result.published_at }}","vendor":"{% include 'json_cleanup' with result.vendor %}","type":"{% include 'json_cleanup' with result.type %}","tags":"{% include 'json_cleanup' with result.tags %}","object_type":"{{ result.object_type }}","sku":"{% include 'json_cleanup' with result.first_available_variant.sku %}",{% capture allinfo %} {{ result.title }} {{ result.tags }} {{ result.vendor }} {{ result.type }} {{result.first_available_variant.sku}} {% endcapture %}"allinfo":"{% include 'json_cleanup' with allinfo %}"},{% endif %}{% endfor %}{"title":"", "id":"", "price":"", "allinfo":""}]{%else%}{[ ]}{% endif %}{% endcapture %}{% comment %}Enclose in square brackets and output the json object{% endcomment %}{% comment %}{{ output | strip_newlines | prepend: '[' | append: ']' }}{% endcomment %}{{ output | strip_newlines }}{% endpaginate %}